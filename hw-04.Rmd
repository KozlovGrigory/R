---
title: "Домашнее задание 04 - Какую специальность выбрать?"
author: "Григорий Козлов"
date: "15.12.21"
output:
  md_document:
    variant: markdown_github
---

Первым шагом в процессе превращения информации в знания является обобщение и описание необработанной информации - данных.
В этом задании мы исследуем данные по специальностям и доходам в колледжах, в частности, эти данные используются в статье на сайте FiveThirtyEight ["The Economic Guide To Picking A College Major"](https://fivethirtyeight.com/features/the-economic-guide-to-picking-a-college-major/).

Первоначально эти данные взяты из исследования American Community Survey (ACS) за 2010-2012 годы. Хотя это выходит за рамки этого задания, если вам интересно, как необработанные данные из ACS были очищены и подготовлены, см. [скрипт](https://github.com/fivethirtyeight/data/blob/master/college-majors/college-majors-rscript.R), который использовали авторы FiveThirtyEight.

Следует также отметить, что при выборе специальности необходимо учитывать множество факторов. Потенциальный заработок и перспективы трудоустройства - это два из них, и они важны, но не раскрывают всей картины.
Помните об этом при анализе данных.

## Load packages and data

Мы будем использовать пакет **tidyverse** для большей части обработки и визуализации данных, пакет **scales** для лучшего форматирования меток на графиках, а данные содержатся в пакете **fivethirtyeight**. Убедитесь, что эти пакеты установлены на Вашем компьютере.

```{r load-packages, message = FALSE}
library(tidyverse)
library(scales)
library(fivethirtyeight)
```

## Данные

Данные можно найти в пакете **fivethirtyeight**, набора данных называется `college_recent_grads`.
Поскольку набор данных распространяется вместе с пакетом, его не нужно загружать его отдельно: он становится  доступен, когда загружается пакет.
Вы можете узнать больше о наборе данных, просмотрев его документацию, к которой вы можете получить доступ, выполнив выражение `?college_recent_grads` в консоли. Вы также можете найти эту информацию [здесь](https://fivethirtyeight-r.netlify.app/reference/college_recent_grads.html).

Вы также можете взглянуть на свой фрейм данных и просмотреть его размеры с помощью функции `glimpse`.

```{r glimpse}
glimpse(college_recent_grads)
```

Фрейм `college_recent_grads` - кладезь информации.
Давайте подумаем о некоторых вопросах, на которые мы, возможно, захотим ответить с помощью этих данных:

- В какой отрасли самый низкий уровень безработицы?
- На какой специальности больше всего женщин?
- Как распределен медианный доход по основным категориям специальностей?
- Женщины склонны выбирать специальности с более низким или более высоким заработком?

Мы попробуем ответить на эти вопросы.

## В какой отрасли самый низкий уровень безработицы?

Чтобы ответить на этот вопрос, нам нужно просто отсортировать данные.
Для этого мы используем функцию `arrange` и отсортируем данные по переменной `unemployment_rate`.
По умолчанию `arrange` сортирует в порядке возрастания, что нам и требуется - нас интересует специальность с *самым низким* уровнем безработицы.

```{r lowest-unemp}
college_recent_grads %>%
  arrange(unemployment_rate)
```

Это дает нам то, что мы хотели, но не в идеальной форме.
Во-первых, название специальности почти не помещается на странице.
Во-вторых, некоторые переменные не особо полезны (например, `major_code`, `major_category`), а те, которые мы хотим видеть в первую очередь, запртаны очень глубоко (например, `unemployment_rate`).

Мы можем использовать функцию `select`, чтобы выбрать, какие переменные отображать и в каком порядке:

```{r lowest-unemp-select}
college_recent_grads %>%
  arrange(unemployment_rate) %>%
  select(rank, major, unemployment_rate)
```

Хорошо, так выглядит лучше, но действительно ли нам нужно отображать все эти десятичные знаки в переменной безработицы?
Не совсем!

Мы можем использовать функцию `percent()`, чтобы немного сократить отображение.

```{r}
college_recent_grads %>%
  arrange(unemployment_rate) %>%
  select(rank, major, unemployment_rate) %>%
  mutate(unemployment_rate = percent(unemployment_rate))
```

## На какой специальности больше всего женщин?

Для ответа на этот вопрос нужно расположить данные в порядке убывания.
Например, если бы в предыдущем вопросе нас интересовала специализация с самым высоким уровнем безработицы, мы бы использовали следующий код (функция `desc` определяет обратный порядок сортировки):

```{r}
college_recent_grads %>%
  arrange(desc(unemployment_rate)) %>%
  select(rank, major, unemployment_rate)
```

### Упражнение 1

Расположите данные в порядке убывания доли женщин в каждой специальности и отобразите только следующие переменные: специальность, общее количество людей и доля женщин. Отобразите только 3 верхних специальности, добавив в конце конвейера `top_n(3)`.

```{r women_speciality}
college_recent_grads %>%
  arrange(desc(sharewomen)) %>%
  select(major_category, total, sharewomen) %>%
  top_n(3)
```

## Как распределен медианный доход по основным категориям специальностей?

Процентиль - это мера, используемая в статистике, указывающая значение, ниже которого наодится определенный процент наблюдений в выборке. Например, 20-й процентиль - это значение, меньше которого 20% наблюдений. 

Во фрейме представлены три типа доходов: `p25th`, `median` и `p75th`.
Они соответствуют 25-му, 50-му и 75-му процентилям распределения доходов людей, получивших данную специальность.

### Упражнение 2

Вопрос, на который мы хотим ответить: «Как распределен медианный доход по основным категориям специальностей?».
Чтобы ответить на этот вопрос, нам нужно сделать несколько действий. Во-первых, нам нужно сгруппировать данные по `major_category`.
Затем нам нужен способ обобщить и представить распределение медианного дохода внутри этих групп.
Это решение будет зависеть от формы этих распределений. Итак, сначала нам нужно визуализировать данные.

Для этого мы используем функцию `ggplot()`.
Первый аргумент - это фрейм, а следующий аргумент задает соответствие переменных эстетикам графика.

Начнем с простого и посмотрим на распределение всех медианных доходов без учета основных категорий. Постройте гистограмму переменной `median`.
Хорошая практика - попробовать несколько значений ширины интервала, прежде чем сделать окончательный выбор.
Вы можете спросить себя: «Какова будет осмысленная разница в медианных доходах?» \$1 явно слишком мало, \$10000 может быть слишком много.
Выберите оптимальную ширину интервала. Попробуйте ширину \$1000 и \$5000 и выберите один вариант. Объясните, почему вы сделали свой выбор. Обратите внимание, что ширина интервала является аргументом функции `geom_histogram`. Например, чтобы указать ширину интервала \$1000, нужно использовать `geom_histogram(binwidth = 1000)`.

Охарактеризуйте форму распределения. Какая мера положения лучше всего описывает типичное значение медианного дохода?

```{r median_hist_1}
college_recent_grads %>%
  group_by(major_category) %>%
  ggplot(aes(x = median)) +
  geom_histogram(binwidth = 5000) +
  labs(x = 'Медианный доход',
       y = 'Частота',
       title = 'Распределение медианных доходов')
```
Оптимальная ширина интервала - 5000, поскольку график получается более наглядным - лучше видны различия в частоте у разных уровней дохода, а величина дохода представлена в более явном виде.
Распределение унимодальное, скошено вправо. Лучшей мерой положения, описывающей
типичное значение медианного дохода является медиана, поскольку она выражает значение, находящееся в середине упорядоченного ряда, а следовательно, обладает устойчивостью к выбросам и может адекватно описывать распределение, не являющееся нормальным.

### Упражнение 3

Постройте гистограммы распределения медианного дохода для каждой из категорий специальностей (переменная `major_category`). Используйте параметр binwidth, который вы выбрали в предыдущем упражнении.

```{r median_hist_2}
college_recent_grads %>%
  group_by(major_category) %>%
  ggplot(aes(x = median)) +
  geom_histogram(binwidth = 5000) +
  facet_wrap(~ major_category, nrow = 4) +
  labs(x = 'Медианный доход',
       y = 'Частота',
       title = 'Распределение медианных доходов для разных специальностей')
```

### Упражнение 4

Какая категория специальностей имеет самый высокий типичный медианный доход? Рассчитайте описательные статистики для категорий специальностей, упорядочите категории по убыванию типичного дохода.

``` {r high_median_profit}
college_recent_grads %>%
  group_by(major_category) %>%
  summarise(min_profit = min(median), max_profit = max(median),
            mean_profit = mean(median), median_profit = median(median),
            sd_profit = sd(median), 
            q1 = quantile(median, probs = 0.25),
            q3 = quantile(median, probs = 0.75)) %>%
  arrange(desc(median_profit)) %>%
  select(major_category, median_profit, mean_profit, sd_profit, q1, q3)
```
Самый высокий медианный доход имеет специальность "Engineering".

### Упражнение 5

Какая категория специальностей наименее популярна в этой выборке? Чтобы ответить на этот вопрос, используйте  функцию `count`, которая сначала группирует данные, а затем подсчитывает количество наблюдений в каждой категории. Упорядочите результаты так, чтобы категория с наименьшей частотой была наверху.

``` {r least_popular}
college_recent_grads %>%
  count(major_category) %>%
arrange(n)
```
Наименее популярна специальность "Interdisciplinary".

### Упражнение 6

Создайте во фрейме новую переменную `major_type`, которая принимает значение `stem` для естественно-научных категорий (Biology & Life Science, Computers & Mathematics, Engineering, Physical Sciences) и значение `non-stem` для всех остальных.

```{r natural_science}
major_type <- c("Biology & Life Science", "Computers & Mathematics", "Engineering", "Physical Sciences")
college_recent_grads <- college_recent_grads %>%
  mutate(major_type = if_else(major_category %in% major_type, "stem", "not stem"))
```

### Упражнение 7

У каких естественно-научных специальностей медианная заработная плата равна или меньше медианы для заработка всех специальностей? Результат должен отображать только название специальности и медианный доход, 25-й процентиль и 75-й процентиль заработка для этой специальности, он также должен быть отсортирован по убыванию медианного дохода.

``` {r medmed}
college_recent_grads %>%
  filter(major_type == "stem", 
         median <= median(college_recent_grads$median)) %>%
  select(major, median, p25th, p75th) %>%
  arrange(desc(median))
```

### Упражнение 8

Создайте диаграмму зависимости медианного дохода от доли женщин в этой специальности, окрашенной в зависимости от того, является специальность естественно-научной или нет. Опишите связь между этими тремя переменными.

``` {r median_diagram}
ggplot(college_recent_grads, 
       aes(x = sharewomen, y = median, color = major_type)) +
  geom_point() +
  labs(x = "Доля женщин",
    y = "Медианный доход",
    title = "Зависимость медианного дохода от доли женщин в специальности")
```
Наибольшее число женщин имеет не связанную с естественно-научным направлением специальность и низкий медиальный доход. Женщины на специальностях естественно-научного профиля в большинстве случаев имеют более высокий медианный доход.